
<div class="asistencia-dashboard">
      <h2>Reporte de asistencia</h2>

  <!-- Barra de filtros -->
  <form class="toolbar" [formGroup]="filtroForm" (ngSubmit)="buscarAsistencias()">
    <div class="toolbar__row">
      <select formControlName="docente" class="input">
        <option value="">Seleccione un docente</option>
        <option *ngFor="let d of docentes" [value]="d">{{ d }}</option>
      </select>

      <select formControlName="grupo" class="input">
        <option value="">Seleccione un grupo</option>
        <option value="6Â°">6Â°</option>
        <option value="7Â°">7Â°</option>
        <option value="8Â°">8Â°</option>
        <option value="9Â°">9Â°</option>
        <option value="10Â°">10Â°</option>
        <option value="11Â°">11Â°</option>
      </select>

      <input type="date" formControlName="fechaInicio" class="input" />
      <input type="date" formControlName="fechaFin" class="input" />

      <button type="submit" class="btn btn--primary">ðŸ”Ž Buscar</button>
    </div>
  </form>

  <hr class="divider" />

  <div *ngIf="estudiantes.length" class="panel">
    <div class="panel__actions">
      <button class="btn" (click)="generarPDF()">ðŸ“„ Descargar PDF</button>
      <button class="btn" (click)="exportarExcel()">ðŸ“¥ Descargar Excel</button>
    </div>

    <div class="table-wrap">
      <table class="tabla">
        <thead>
          <tr>
            <th class="sticky-col">Estudiante</th>
            <th *ngFor="let f of fechas" class="fecha-col">{{ f }}</th>
            <th class="compact">% Asistencia</th>
            <th class="compact">PDF</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let e of estudiantes; let i = index" [class.alt]="i % 2 === 1">
            <td class="sticky-col name-col">{{ e }}</td>

            <!-- celdas estado con badge de color -->
            <td *ngFor="let f of fechas" class="estado-col">
              <span 
                [ngClass]="{
                  'badge': true,
                  'badge--empty': !tablaAsistencia[e]?.[f],
                  'badge--ok': tablaAsistencia[e]?.[f]==='presente',
                  'badge--bad': tablaAsistencia[e]?.[f]==='ausente',
                  'badge--info': tablaAsistencia[e]?.[f]==='cita',
                  'badge--mid': tablaAsistencia[e]?.[f]==='en cuarto',
                  'badge--warn': tablaAsistencia[e]?.[f]==='hospitalizada' || tablaAsistencia[e]?.[f]==='hospitalizado'
                }"
              >
                {{ tablaAsistencia[e]?.[f] || '-' }}
              </span>
            </td>

            <!-- barra de porcentaje -->
            <td class="compact">
              <div class="bar">
                <div class="bar__fill" [style.width.%]="calcularPorcentaje(e)"></div>
              </div>
              <span class="bar__text">{{ calcularPorcentaje(e) }}%</span>
            </td>

            <td class="compact">
              <button class="btn btn--icon" (click)="generarPDFIndividual(e)">ðŸ“„</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
